import{ar as f,as as u}from"../.pnpm/.pnpm.BXQlrSzc.js";const c={401:"认证失败，无法访问系统资源",403:"当前操作没有权限",404:"访问资源不存在",default:"系统未知错误，请反馈给管理员"};function S(e){let t="";for(const o of Object.keys(e)){const s=e[o],r=`${encodeURIComponent(o)}=`;if(s!==null&&s!==""&&typeof s<"u")if(typeof s=="object"){for(const n of Object.keys(s))if(s[n]!==null&&s[n]!==""&&typeof s[n]<"u"){const a=`${o}[${n}]`,i=`${encodeURIComponent(a)}=`;t+=`${i+encodeURIComponent(s[n])}&`}}else t+=`${r+encodeURIComponent(s)}&`}return t}const p={set(e,t){sessionStorage&&e!==null&&t!==null&&sessionStorage.setItem(e,t)},get(e){return!sessionStorage||e===null?null:sessionStorage.getItem(e)},setJSON(e,t){t!==null&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);return t!==null?JSON.parse(t):t},remove(e){e&&sessionStorage.removeItem(e)}},O={set(e,t){localStorage&&e!==null&&t!==null&&localStorage.setItem(e,t)},get(e){return!localStorage||e===null?null:localStorage.getItem(e)},setJSON(e,t){t!==null&&this.set(e,JSON.stringify(t))},getJSON(e){const t=this.get(e);return t!==null?JSON.parse(t):t},remove(e){localStorage.removeItem(e)}},l={session:p,local:O},m=f.create({baseURL:"",timeout:3e3,withCredentials:!0});m.interceptors.request.use(e=>{var o;if(e.method==="get"&&e.params){let s=`${e.url}?${S(e.params)}`;s=s.slice(0,-1),e.params={},e.url=s}if(!(((o=e.headers||{})==null?void 0:o.isRepeatSubmit)===!1)&&(e.method==="post"||e.method==="put")){const s={url:e.url,data:typeof e.data=="object"?JSON.stringify(e.data):e.data,time:new Date().getTime()},r=l.session.getJSON("sessionObj");if(r==null||r==="")l.session.setJSON("sessionObj",s);else{const n=r.url,a=r.data,i=r.time;if(a===s.data&&s.time-i<1e3&&n===s.url){const d="数据正在处理，请勿重复提交";return Promise.reject(new Error(d))}l.session.setJSON("sessionObj",s)}}return e},e=>Promise.reject(e));m.interceptors.response.use(e=>{var s,r;const t=((s=e.data)==null?void 0:s.code)||200,o=c[t]||((r=e.data)==null?void 0:r.message)||c.default;return t!==200?(u({message:o,forbidClick:!0}),Promise.reject(o)):Promise.resolve(e.data)},e=>{let{message:t}=e;return t==="Network Error"?t="后端接口连接异常":t.includes("timeout")?t="系统接口请求超时":t.includes("Request failed with status code")&&(t=`系统接口${t.substring(t.length-3)}异常`),u({message:t,forbidClick:!0,duration:5e3}),Promise.reject(e)});export{m as s};
